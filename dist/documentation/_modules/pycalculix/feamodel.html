
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>pycalculix.feamodel &#8212; pycalculix 1.1.4 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pycalculix.feamodel</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; This module stores the FeaModel class.</span>

<span class="sd">This class is the highest level object in a pycalculix program.</span>
<span class="sd">It stores all parts, loads, constraints, mesh, problem, and results_file</span>
<span class="sd">objects.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PatchCollection</span>  <span class="c1"># element plotting</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cmx</span>
<span class="kn">import</span> <span class="nn">subprocess</span> <span class="c1"># used to launch meshers cgx and gmsh</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="c1"># used to delete files written by cgx</span>
<span class="kn">from</span> <span class="nn">numpy.core.function_base</span> <span class="kn">import</span> <span class="n">linspace</span> <span class="c1"># need to make contours</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">environment</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">base_classes</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">material</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">components</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">connectors</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">loads</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">mesh</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">partmodule</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">problem</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">selector</span>

<span class="c1"># element colors, 0-1, 0=black, 1=whate</span>
<span class="n">ECOLOR</span> <span class="o">=</span> <span class="s1">&#39;.4&#39;</span>
<span class="n">FCOLOR</span> <span class="o">=</span> <span class="s1">&#39;.9&#39;</span>
<span class="n">CMAP</span> <span class="o">=</span> <span class="s1">&#39;jet&#39;</span> <span class="c1"># for results</span>
<span class="n">GEOM_CMAP</span> <span class="o">=</span> <span class="s1">&#39;Pastel1&#39;</span> <span class="c1"># color map for parts or areas</span>

<div class="viewcode-block" id="FeaModel"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel">[docs]</a><span class="k">class</span> <span class="nc">FeaModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Makes a FeaModel instance.</span>

<span class="sd">    Parts, area, lines, arcs, points, nodes, elements, faces, models,</span>
<span class="sd">    components, and loads are stored in this object.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_name (str): project name for this FeaModel, this is a file prefix</span>
<span class="sd">        ccx (None or str): path to Calculix ccx solver, pass this when you want</span>
<span class="sd">            to overwite the default program location.</span>
<span class="sd">            None means the default envionment.CCX is used.</span>
<span class="sd">        cgx (None or str): path to Calculix cgx mesher, pass this when you want</span>
<span class="sd">            to overwite the default program location.</span>
<span class="sd">            None means the default envionment.CGX is used.</span>
<span class="sd">        gmsh (None or str): path to gmsh mesher, pass this when you want</span>
<span class="sd">            to overwite the default program location.</span>
<span class="sd">            None means the default envionment.GMSH is used.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        fname (str): FeaModel project file name prefix</span>
<span class="sd">        points (Itemlist): list of all Point</span>
<span class="sd">        lines (Itemlist): list of all Line and Arc</span>
<span class="sd">        signlines (Itemlist): list of all SignLine and SignArc</span>
<span class="sd">        lineloops (Itemlist): list of all LineLoop, each contains SignLine SignArc</span>
<span class="sd">        areas (Itemlist):list of all Area, each contains LineLoop(s)</span>
<span class="sd">        parts (Itemlist): list of all Part</span>
<span class="sd">        matls (Itemlist): list of all materials</span>
<span class="sd">        components (Itemlist): list of all components</span>
<span class="sd">        loads (dict): a dictionary of loads</span>

<span class="sd">            | Key (float): the load time point</span>
<span class="sd">            | loads[time] = list of loads for that time step</span>
<span class="sd">            | See method set_time to change the current time.</span>
<span class="sd">            | Time = 0.0 stores constant loads, such as:</span>
<span class="sd">            |    material, thickness</span>

<span class="sd">        contacts (Itemlist): list of contacts</span>
<span class="sd">        surfints (Itemlist): list of surface interactions</span>
<span class="sd">        problems (Itemlist): list of problems</span>
<span class="sd">        nodes (Meshlist): list of all mesh nodes</span>
<span class="sd">        eshape (str): element shape</span>

<span class="sd">            - &#39;quad&#39;: quadrilateral elements (Default)</span>
<span class="sd">            - &#39;tri&#39;: triangle elements</span>
<span class="sd">        eorder (int): element order, 1 or 2</span>

<span class="sd">            - 1: elements meshed with corner nodes only</span>
<span class="sd">            - 2: (Default) elements meshed with corner and midside nodes</span>
<span class="sd">        elements (Meshlist): list of all mesh elements</span>
<span class="sd">        faces (list): list of all element faces, includes non-exterior ones</span>
<span class="sd">        view (Selector): currently selected items</span>

<span class="sd">            Attributes:</span>
<span class="sd">                parts: list of selected parts</span>
<span class="sd">                areas: list of selected areas</span>
<span class="sd">                lines: list of selected signed lines or arcs</span>
<span class="sd">                points: list of selected points</span>
<span class="sd">                elements: list of selected elements</span>
<span class="sd">                faces: list of selected faces</span>
<span class="sd">                nodes: list of selected nodes</span>
<span class="sd">        time (float): current model time value, defaults to 1.0</span>
<span class="sd">        units (dict): a dict to store units for different fields</span>

<span class="sd">            Keys:</span>
<span class="sd">                - &#39;displ&#39;: displacement or location</span>
<span class="sd">                - &#39;force&#39;: force</span>
<span class="sd">                - &#39;stress&#39;: stress</span>
<span class="sd">                - &#39;temp&#39;: temperature</span>
<span class="sd">                - &#39;density&#39;: density (mass/volume)</span>
<span class="sd">                - &#39;time&#39;: time</span>

<span class="sd">            Returns:</span>
<span class="sd">                Text string describing the units for the given key field.</span>

<span class="sd">                See the set_units method.</span>

<span class="sd">                For example when units have been set to metric, the below</span>
<span class="sd">                values are returned.</span>

<span class="sd">                - &#39;dist&#39; --&gt; &#39;m&#39;</span>
<span class="sd">                - &#39;density&#39; --&gt; &#39;kg/(m^3)&#39;</span>
<span class="sd">                - &#39;time&#39; --&gt; &#39;s&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">ccx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cgx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gmsh</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signlines</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineloops</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areas</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matls</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loads</span> <span class="o">=</span> <span class="p">{}</span>    <span class="c1"># store loads by time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surfints</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problems</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Meshlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Meshlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># 0 is model set-up, 1 is first step, etc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span> <span class="o">=</span> <span class="s1">&#39;quad&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eorder</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># fix the paths to the needed programs, ccx, cgx, and gmsh</span>
        <span class="k">if</span> <span class="n">ccx</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">environment</span><span class="o">.</span><span class="n">CCX</span> <span class="o">=</span> <span class="n">ccx</span>
        <span class="k">if</span> <span class="n">cgx</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">environment</span><span class="o">.</span><span class="n">CGX</span> <span class="o">=</span> <span class="n">cgx</span>
        <span class="k">if</span> <span class="n">gmsh</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">environment</span><span class="o">.</span><span class="n">GMSH</span> <span class="o">=</span> <span class="n">gmsh</span>

<div class="viewcode-block" id="FeaModel.set_ediv"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_ediv">[docs]</a>    <span class="k">def</span> <span class="nf">set_ediv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">ediv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the number of elements on the passed line.</span>

<span class="sd">        Args:</span>
<span class="sd">            items (str or SignLine or SignArc or list): lines to set ediv on</span>

<span class="sd">                - str: &#39;L0&#39;</span>
<span class="sd">                - list of str [&#39;L0&#39;, &#39;L1&#39;]</span>
<span class="sd">                - list of SignLine or SignArc part.bottom or part.hole[-1]</span>

<span class="sd">            ediv (int): number of elements to mesh on the line</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_ediv</span><span class="p">(</span><span class="n">ediv</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.set_esize"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_esize">[docs]</a>    <span class="k">def</span> <span class="nf">set_esize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">esize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the element size on the passed line.</span>

<span class="sd">        Args:</span>
<span class="sd">            items (str or SignLine or SignArc or list): lines or points to set esize on</span>

<span class="sd">                - str: &#39;L0&#39;</span>
<span class="sd">                - list of str [&#39;L0&#39;, &#39;L1&#39;, &#39;P3&#39;]</span>
<span class="sd">                - list of SignLine or SignArc part.bottom or part.hole[-1]</span>

<span class="sd">            esize (float): size of the mesh elements on the line</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">set_esize</span><span class="p">(</span><span class="n">esize</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.set_units"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_units">[docs]</a>    <span class="k">def</span> <span class="nf">set_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_unit</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">cfswitch</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the units that will be displayed when plotting.</span>

<span class="sd">        Picks a unit set based on the passed distance unit.</span>
<span class="sd">        That unit set is printed to the console when set.</span>
<span class="sd">        Defaults to MKS units (meter-kilogram-second)</span>

<span class="sd">        ========  =====  ======  ===========  ===============  ====</span>
<span class="sd">        Distance  Force  Stress  Temperature  Density          Time</span>
<span class="sd">        ========  =====  ======  ===========  ===============  ====</span>
<span class="sd">        &#39;m&#39;       &#39;N&#39;    &#39;Pa&#39;    &#39;K&#39;          &#39;kg/(m^3)&#39;       &#39;s&#39;</span>
<span class="sd">        &#39;mm&#39;      &#39;N&#39;    &#39;MPa&#39;   &#39;K&#39;          &#39;tonne/(mm^3)&#39;   &#39;s&#39;</span>
<span class="sd">        &#39;in&#39;      &#39;lbf&#39;  &#39;psi&#39;   &#39;R&#39;          &#39;slinch/(in^3)&#39;  &#39;s&#39;</span>
<span class="sd">        &#39;ft&#39;      &#39;lbf&#39;  &#39;psf&#39;   &#39;R&#39;          &#39;slug/(ft^3)&#39;    &#39;s&#39;</span>
<span class="sd">        ========  =====  ======  ===========  ===============  ====</span>

<span class="sd">        See get_units method or returning text strings based on unit types.</span>

<span class="sd">        Args:</span>
<span class="sd">            dist_unit (str): string of distance unit. Options:</span>

<span class="sd">                - &#39;m&#39;: meter</span>
<span class="sd">                - &#39;mm&#39;: milimeter</span>
<span class="sd">                - &#39;in&#39;: inch</span>
<span class="sd">                - &#39;ft&#39;: foot</span>

<span class="sd">            cfswitch (bool): Celsius/Fahrenheit temperature switch.</span>
<span class="sd">                Default is False.</span>

<span class="sd">                If True, this switches temperature from K--&gt;C or from R--&gt;F</span>
<span class="sd">                Default keeps units as shown in above table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;force&#39;</span><span class="p">,</span> <span class="s1">&#39;stress&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">]</span>

        <span class="n">m_newton</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;Pa&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;kg/(m^3)&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>
        <span class="n">mm_newton</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mm&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;MPa&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;tonne/(mm^3)&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>
        <span class="n">in_lbf</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;lbf&#39;</span><span class="p">,</span> <span class="s1">&#39;psi&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;slinch/(in^3)&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>
        <span class="n">ft_lbf</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ft&#39;</span><span class="p">,</span> <span class="s1">&#39;lbf&#39;</span><span class="p">,</span> <span class="s1">&#39;psf&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;slug/(ft^3)&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>
        <span class="n">unit_systems</span> <span class="o">=</span> <span class="p">[</span><span class="n">m_newton</span><span class="p">,</span> <span class="n">mm_newton</span><span class="p">,</span> <span class="n">in_lbf</span><span class="p">,</span> <span class="n">ft_lbf</span><span class="p">]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">usys</span> <span class="k">for</span> <span class="n">usys</span> <span class="ow">in</span> <span class="n">unit_systems</span> <span class="k">if</span> <span class="n">usys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">dist_unit</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cfswitch</span><span class="p">:</span>
            <span class="c1"># switches K--&gt;C and R--&gt;F</span>
            <span class="n">newunit</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;K&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="s1">&#39;F&#39;</span><span class="p">}</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newunit</span><span class="p">[</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]]</span>

        <span class="c1"># set values</span>
        <span class="n">adict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">vals</span><span class="p">))</span>
        <span class="n">adict</span><span class="p">[</span><span class="s1">&#39;displ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adict</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;================================================&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Units have been set to </span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">adict</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">],</span> <span class="n">adict</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">adict</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For </span><span class="si">%s</span><span class="s1"> use </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">adict</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;================================================&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">adict</span></div>

<div class="viewcode-block" id="FeaModel.get_units"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.get_units">[docs]</a>    <span class="k">def</span> <span class="nf">get_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns units for the passed arguments. Accepts and returns a list</span>
<span class="sd">        of strings.</span>

<span class="sd">        Options for inputs:</span>
<span class="sd">            - &#39;dist&#39;</span>
<span class="sd">            - &#39;displ&#39; (same units as &#39;dist&#39;)</span>
<span class="sd">            - &#39;force&#39;</span>
<span class="sd">            - &#39;stress&#39;</span>
<span class="sd">            - &#39;temp&#39;</span>
<span class="sd">            - &#39;density&#39;</span>
<span class="sd">            - &#39;time&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">:</span>
                <span class="c1"># check if the requested item is in the units dict</span>
                <span class="n">mystr</span> <span class="o">=</span> <span class="s1">&#39; (&#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="k">elif</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">FIELDTYPE</span><span class="p">:</span>
                <span class="c1"># return units on results dict item, ex: stress, strain etc</span>
                <span class="n">ftype</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">FIELDTYPE</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ftype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">:</span>
                    <span class="n">mystr</span> <span class="o">=</span> <span class="s1">&#39; (&#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">ftype</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="FeaModel.set_time"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_time">[docs]</a>    <span class="k">def</span> <span class="nf">set_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the time in the FeaModel (preprocessor).</span>

<span class="sd">        This time is used when setting loads.</span>

<span class="sd">        Args:</span>
<span class="sd">            time (float): the time to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span></div>

<div class="viewcode-block" id="FeaModel.get_item"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.get_item">[docs]</a>    <span class="k">def</span> <span class="nf">get_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an item given a string identifying the item.</span>

<span class="sd">        Args:</span>
<span class="sd">            item (str): &#39;A0&#39; or &#39;P0&#39; or &#39;L0&#39; etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
            <span class="c1"># get point</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">num</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
            <span class="c1"># get line</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signlines</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="c1"># get area</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">num</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
            <span class="c1"># get element</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>
            <span class="c1"># get node</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unknown item! Please pass the name of a point, line or area!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.get_items"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.get_items">[docs]</a>    <span class="k">def</span> <span class="nf">get_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of correctly typed items.</span>

<span class="sd">        Input can be a single string or item, or a list of strings identifying</span>
<span class="sd">        items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res_items</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">res_items</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">res_items</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res_items</span></div>

<div class="viewcode-block" id="FeaModel.make_matl"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.make_matl">[docs]</a>    <span class="k">def</span> <span class="nf">make_matl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes and returns a new material.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): the material&#39;s name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mat</span></div>

<div class="viewcode-block" id="FeaModel.make_part"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.make_part">[docs]</a>    <span class="k">def</span> <span class="nf">make_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes and returns a new part.&quot;&quot;&quot;</span>
        <span class="c1">#p = part.Part(self)</span>
        <span class="c1">#self.parts.append(p)</span>
        <span class="k">return</span> <span class="n">partmodule</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.make_problem"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.make_problem">[docs]</a>    <span class="k">def</span> <span class="nf">make_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem_type</span><span class="o">=</span><span class="s1">&#39;struct&#39;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes and returns a new problem, which can be solved.</span>

<span class="sd">        Args:</span>
<span class="sd">            problem_type (str): problem type, options:</span>
<span class="sd">                &#39;struct&#39;: structural</span>
<span class="sd">            parts (str Part or list of Part): Parts the model will analyze.</span>

<span class="sd">                Options:</span>
<span class="sd">                    - &#39;all&#39;: add all parts. This is the default.</span>
<span class="sd">                    - Part: add the single part</span>
<span class="sd">                    - list of Part: add these parts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parts</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem_type</span><span class="p">,</span> <span class="n">parts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prob</span></div>

<div class="viewcode-block" id="FeaModel.print_summary"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.print_summary">[docs]</a>    <span class="k">def</span> <span class="nf">print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints a summary of the items in the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;parts&#39;</span><span class="p">,</span> <span class="s1">&#39;areas&#39;</span><span class="p">,</span> <span class="s1">&#39;signlines&#39;</span><span class="p">,</span> <span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">,</span> <span class="s1">&#39;faces&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;nodes&#39;</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;parts&#39;</span><span class="p">,</span> <span class="s1">&#39;areas&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">,</span> <span class="s1">&#39;faces&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;nodes&#39;</span><span class="p">]</span>

        <span class="n">spacer</span> <span class="o">=</span> <span class="s1">&#39;----------------------------------&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">spacer</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Items in the database:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">item_str</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_str</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1">: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">spacer</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_nodes"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">plot_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Nodes&#39;</span><span class="p">,</span> <span class="n">nnum</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the selected nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): png image file prefix, if given, image will be saved</span>
<span class="sd">            display (bool): if True, interactive plot will be shown, if False</span>
<span class="sd">                plot will not be shown</span>
<span class="sd">            title (str): the plot&#39;s title</span>
<span class="sd">            nnum (bool): if True node numbers are plotted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">nodes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># plotting elements</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

            <span class="c1"># plot nodes, this is quicker than individual plotting</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">rads</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">rads</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nnum</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

            <span class="c1"># set units</span>
            <span class="p">[</span><span class="n">d_unit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="s1">&#39;dist&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;axial, y&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;radial, x&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>

            <span class="c1"># extract max and min for plot window</span>
            <span class="n">radials</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">axials</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>

            <span class="c1"># finish pot</span>
            <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_set_bounds</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">axials</span><span class="p">,</span> <span class="n">radials</span><span class="p">)</span>
            <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_finish</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no elements exist or no elemnts are selected</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;No nodes exist! Try meshing your parts!&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;No nodes are selected! Select some!&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_elements"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_elements">[docs]</a>    <span class="k">def</span> <span class="nf">plot_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Elements&#39;</span><span class="p">,</span>
                      <span class="n">enum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nshow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nnum</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the selected elements.</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): png image file prefix, if given, image will be saved</span>
<span class="sd">            display (bool): if True, interactive plot will be shown, if False</span>
<span class="sd">                plot will not be shown</span>
<span class="sd">            title (str): the plot&#39;s title</span>
<span class="sd">            enum (bool): if True element numbers are plotted</span>
<span class="sd">            nshow (bool): True=plot nodes, False=don&#39;t plot them</span>
<span class="sd">            nnum (bool): if True node numbers are plotted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">nodes</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">elements</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># plotting elements</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">polys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">poly</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_poly</span><span class="p">()</span>
                <span class="n">polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">polys</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">FCOLOR</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">ECOLOR</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>

            <span class="c1"># plot element numbers</span>
            <span class="k">if</span> <span class="n">enum</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

            <span class="c1"># plot nodes, this is quicker than individual plotting</span>
            <span class="k">if</span> <span class="n">nshow</span><span class="p">:</span>
                <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
                <span class="n">rads</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">rads</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nnum</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

            <span class="c1"># set units</span>
            <span class="p">[</span><span class="n">d_unit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="s1">&#39;dist&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;axial, y&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;radial, x&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>

            <span class="c1"># extract nodes for elements if no nodes are selected</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="c1"># extract max and min for plot window</span>
            <span class="n">radials</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">axials</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>

            <span class="c1"># finish pot</span>
            <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_set_bounds</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">axials</span><span class="p">,</span> <span class="n">radials</span><span class="p">)</span>
            <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_finish</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no elements exist or no elemnts are selected</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;No elements exist! Try meshing your parts!&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;No elements are selected! Select some!&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_pressures"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_pressures">[docs]</a>    <span class="k">def</span> <span class="nf">plot_pressures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the load step pressures on the passed part(s) or selected</span>
<span class="sd">        elements.</span>

<span class="sd">        This is an element plot, with arrows showing pressure magnitude and</span>
<span class="sd">        directions.</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): png image file prefix, if given, image will be saved</span>
<span class="sd">            display (bool): if True, interactive plot will be shown, if False</span>
<span class="sd">                plot will not be shown. Default = True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">elements</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">faces</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">nodes</span>

        <span class="c1"># plot all elements and store length, length determins min pressure arrow</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># plotting elements</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

            <span class="c1"># plot polys and calculate avg face length</span>
            <span class="n">polys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">face_len</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">face_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">length</span><span class="p">())</span>
                <span class="n">poly</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_poly</span><span class="p">()</span>
                <span class="n">polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">polys</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">ECOLOR</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">FCOLOR</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
            <span class="n">face_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">face_len</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">face_len</span><span class="p">)</span>

            <span class="c1"># store pressures we&#39;ll want to plot: list of [face, pval]</span>
            <span class="n">plist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">load</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">load</span><span class="o">.</span><span class="n">ltype</span> <span class="ow">in</span>  <span class="p">[</span><span class="s1">&#39;press&#39;</span><span class="p">,</span> <span class="s1">&#39;press_fluid&#39;</span><span class="p">]:</span>
                    <span class="n">loadlist</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">get_list</span><span class="p">()</span>
                    <span class="k">for</span> <span class="p">[</span><span class="n">face</span><span class="p">,</span> <span class="n">pval</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loadlist</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
                            <span class="n">plist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">face</span><span class="p">,</span> <span class="n">pval</span><span class="p">])</span>
            <span class="n">pressures</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span> <span class="k">for</span> <span class="p">[</span><span class="n">face</span><span class="p">,</span> <span class="n">pval</span><span class="p">]</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">]</span>

            <span class="c1"># set max and min pressure bounds</span>
            <span class="n">pmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pressures</span><span class="p">)</span>
            <span class="n">pmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pressures</span><span class="p">)</span>
            <span class="c1"># extract nodes for elements if no nodes are selected</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">radials</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">axials</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="c1"># arrow length = arrow_min + (pval-pmin)*mult</span>
            <span class="n">arrow_min</span> <span class="o">=</span> <span class="n">face_len</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">pmax</span> <span class="o">!=</span> <span class="n">pmin</span><span class="p">:</span>
                <span class="n">adelta</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span>
                <span class="n">rdelta</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">adelta</span><span class="p">,</span> <span class="n">rdelta</span><span class="p">)</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="mf">0.2</span>
                <span class="n">mult</span> <span class="o">=</span> <span class="n">dist</span><span class="o">/</span><span class="p">(</span><span class="n">pmax</span> <span class="o">-</span> <span class="n">pmin</span><span class="p">)</span>

            <span class="c1"># make tick list for later plot, and color map</span>
            <span class="n">cbar_val</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">tick_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">pmax</span> <span class="o">!=</span> <span class="n">pmin</span><span class="p">:</span>
                <span class="c1"># we have a range of values we&#39;re plotting</span>
                <span class="n">tick_list</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">CMAP</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cbar_val</span> <span class="o">=</span> <span class="n">pmin</span>
                <span class="n">pmax</span> <span class="o">=</span> <span class="n">pmin</span> <span class="o">+</span> <span class="mf">1.0</span>
                <span class="n">pmin</span> <span class="o">=</span> <span class="n">pmin</span> <span class="o">-</span> <span class="mf">1.0</span>
                <span class="n">tick_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pmin</span><span class="p">,</span> <span class="n">cbar_val</span><span class="p">,</span> <span class="n">pmax</span><span class="p">]</span>  <span class="c1"># default 3 values to plot one solid color</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span> <span class="c1"># default to plot one val</span>

            <span class="c1"># set color contours for arrows</span>
            <span class="n">cnorm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">pmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">pmax</span><span class="p">)</span>
            <span class="n">scalarmap</span> <span class="o">=</span> <span class="n">cmx</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cnorm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
            <span class="n">scalarmap</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>

            <span class="c1"># make arrows, store axials + radials</span>
            <span class="k">for</span> <span class="p">[</span><span class="n">face</span><span class="p">,</span> <span class="n">pval</span><span class="p">]</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
                <span class="p">[</span><span class="n">face_point</span><span class="p">,</span> <span class="n">unit</span><span class="p">]</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">get_mnorm</span><span class="p">()</span>
                <span class="n">arrow_length</span> <span class="o">=</span> <span class="n">arrow_min</span> <span class="o">+</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span> <span class="o">-</span> <span class="n">pmin</span><span class="p">)</span><span class="o">*</span><span class="n">mult</span>
                <span class="n">other_point</span> <span class="o">=</span> <span class="n">face_point</span> <span class="o">+</span> <span class="n">unit</span><span class="o">*</span><span class="n">arrow_length</span>
                <span class="n">radials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_point</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">axials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_point</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

                <span class="c1"># compression</span>
                <span class="n">tail</span> <span class="o">=</span> <span class="n">other_point</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">face_point</span> <span class="o">-</span> <span class="n">other_point</span>
                <span class="k">if</span> <span class="n">pval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># tension</span>
                    <span class="n">tail</span> <span class="o">=</span> <span class="n">face_point</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">other_point</span> <span class="o">-</span> <span class="n">face_point</span>

                <span class="n">headwidth</span> <span class="o">=</span> <span class="n">face_len</span><span class="o">*</span><span class="mf">0.2</span>
                <span class="n">headlength</span> <span class="o">=</span> <span class="n">face_len</span><span class="o">*</span><span class="mf">0.3</span>
                <span class="n">colorval</span> <span class="o">=</span> <span class="n">scalarmap</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pval</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">tail</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tail</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="n">colorval</span><span class="p">,</span>
                          <span class="n">head_width</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                          <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># set the horizontal and vertical axes</span>
            <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_set_bounds</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">axials</span><span class="p">,</span> <span class="n">radials</span><span class="p">)</span>

            <span class="c1"># set units and titles</span>
            <span class="p">[</span><span class="n">d_unit</span><span class="p">,</span> <span class="n">p_unit</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;stress&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">)</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="s1">&#39;Pressures </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Time=</span><span class="si">%f%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">tstr</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;axial, y&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;radial, x&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>

            <span class="c1"># set the colorbar</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scalarmap</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                                <span class="n">ticks</span><span class="o">=</span><span class="n">tick_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cbar_val</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cbar_val</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_finish</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;No elements exist! Try meshing your parts!&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;No elements are selected! Select some!&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_constraints"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">plot_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots the constraints on the passed part(s) or selected items.</span>

<span class="sd">        This is an element and node plot, with arrows showing displacement</span>
<span class="sd">        constraints.</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): png image file prefix, if given, image will be saved</span>
<span class="sd">            display (bool): if True, interactive plot will be shown, if False</span>
<span class="sd">                plot will not be shown. Default = True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">elements</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">nodes</span>

        <span class="c1"># plot all elements</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># plotting elements</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

            <span class="c1"># plot polys and calculate avg face length</span>
            <span class="n">polys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">face_len</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">face_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">length</span><span class="p">())</span>
                <span class="n">poly</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_poly</span><span class="p">()</span>
                <span class="n">polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">polys</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">ECOLOR</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">FCOLOR</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
            <span class="n">face_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">face_len</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">face_len</span><span class="p">)</span>

            <span class="c1"># store displacements we&#39;ll plot: list of [node, dict ux,uy,uz]</span>
            <span class="n">ulist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">load</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">load</span><span class="o">.</span><span class="n">ltype</span> <span class="ow">in</span>  <span class="p">[</span><span class="s1">&#39;ux&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">,</span> <span class="s1">&#39;uz&#39;</span><span class="p">]:</span>
                    <span class="n">alist</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">get_list</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">nodelist</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span>
                        <span class="n">node</span> <span class="o">=</span> <span class="n">nodelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">ulist</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nodelist</span><span class="p">]</span>
                            <span class="n">vals</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodelist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="c1"># check min and max bounds</span>
            <span class="n">pmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">pmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="c1"># make tick list for later plot, and color map</span>
            <span class="n">cbar_val</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">tick_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">pmax</span> <span class="o">!=</span> <span class="n">pmin</span><span class="p">:</span>
                <span class="c1"># we have a range of values we&#39;re plotting</span>
                <span class="n">tick_list</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">CMAP</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cbar_val</span> <span class="o">=</span> <span class="n">pmin</span>
                <span class="n">pmax</span> <span class="o">=</span> <span class="n">pmin</span> <span class="o">+</span> <span class="mf">1.0</span>
                <span class="n">pmin</span> <span class="o">=</span> <span class="n">pmin</span> <span class="o">-</span> <span class="mf">1.0</span>
                <span class="n">tick_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pmin</span><span class="p">,</span> <span class="n">cbar_val</span><span class="p">,</span> <span class="n">pmax</span><span class="p">]</span>  <span class="c1"># default 3 values to plot one solid color</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span> <span class="c1"># default to plot one val</span>

            <span class="c1"># set color contours for arrows</span>
            <span class="n">cnorm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">pmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">pmax</span><span class="p">)</span>
            <span class="n">scalarmap</span> <span class="o">=</span> <span class="n">cmx</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cnorm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
            <span class="n">scalarmap</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>

            <span class="c1"># make arrows for displacements</span>
            <span class="c1"># extract nodes for elements if no nodes are selected</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">radials</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">axials</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">pvect</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                     <span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                     <span class="s1">&#39;uz&#39;</span><span class="p">:</span><span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>
            <span class="k">for</span> <span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">udict</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ulist</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">udict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">headw</span> <span class="o">=</span> <span class="n">face_len</span><span class="o">*</span><span class="mf">0.4</span>
                    <span class="n">headl</span> <span class="o">=</span> <span class="n">headw</span>
                    <span class="n">point</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">pvect</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                    <span class="c1"># nonzero displacement, draw from node</span>
                    <span class="n">tail</span> <span class="o">=</span> <span class="n">point</span>
                    <span class="n">head</span> <span class="o">=</span> <span class="n">tail</span> <span class="o">+</span> <span class="n">unit</span><span class="o">*</span><span class="n">val</span>
                    <span class="n">store_point</span> <span class="o">=</span> <span class="n">head</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># zero displ, draw to node</span>
                        <span class="n">head</span> <span class="o">=</span> <span class="n">point</span>
                        <span class="n">tail</span> <span class="o">=</span> <span class="n">head</span> <span class="o">-</span> <span class="n">unit</span><span class="o">*</span><span class="n">face_len</span>
                        <span class="n">store_point</span> <span class="o">=</span> <span class="n">tail</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">head</span> <span class="o">-</span> <span class="n">tail</span>
                    <span class="n">radials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">store_point</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">axials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">store_point</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

                    <span class="n">colorVal</span> <span class="o">=</span> <span class="n">scalarmap</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">tail</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tail</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">colorVal</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="n">headw</span><span class="p">,</span>
                              <span class="n">head_length</span><span class="o">=</span><span class="n">headl</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># set the horizontal and vertical axes</span>
            <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_set_bounds</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">axials</span><span class="p">,</span> <span class="n">radials</span><span class="p">)</span>

            <span class="c1"># set units + titles</span>
            <span class="p">[</span><span class="n">d_unit</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">)</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="s1">&#39;Constraints </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Time=</span><span class="si">%f%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">tstr</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;axial, y&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;radial, x&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>

            <span class="c1"># set the colorbar</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scalarmap</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                                <span class="n">ticks</span><span class="o">=</span><span class="n">tick_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cbar_val</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cbar_val</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_finish</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;No elements exist! Try meshing your parts!&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;No elements are selected! Select some!&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_multiple"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_multiple">[docs]</a>    <span class="k">def</span> <span class="nf">plot_multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="n">styledict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;labels&#39;</span><span class="p">:[</span><span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="s1">&#39;areas&#39;</span><span class="p">,</span> <span class="s1">&#39;parts&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;items&#39;</span><span class="p">:[</span><span class="s1">&#39;points, lines, areas&#39;</span><span class="p">]}):</span>
        <span class="sd">&quot;&quot;&quot;Plots items of type styledict[&#39;items&#39;], labels styledict[&#39;labels&#39;]</span>

<span class="sd">        Only the items currently selected will be plotted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># http://stackoverflow.com/questions/470690/how-to-automatically-generate-n-distinct-colors/4382138#4382138</span>
        <span class="c1"># http://stackoverflow.com/questions/2328339/how-to-generate-n-different-colors-for-any-natural-number-n</span>
        <span class="c1"># start plotting</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="c1"># check if we&#39;re plotting parts or areas and pick a color map</span>
        <span class="n">colormaker</span><span class="p">,</span> <span class="n">ids</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">color_plot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;parts&#39;</span> <span class="ow">in</span> <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]:</span>
            <span class="n">color_plot</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">parts</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;areas&#39;</span> <span class="ow">in</span> <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]:</span>
                <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;areas&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;areas&#39;</span> <span class="ow">in</span> <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]:</span>
            <span class="n">color_plot</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">areas</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">color_plot</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">GEOM_CMAP</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">ids</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
            <span class="n">colormaker</span> <span class="o">=</span> <span class="n">cmx</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

        <span class="c1"># plot the items</span>
        <span class="k">for</span> <span class="n">item_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="s1">&#39;areas&#39;</span><span class="p">,</span> <span class="s1">&#39;parts&#39;</span><span class="p">]:</span>
            <span class="n">plot_on</span> <span class="o">=</span> <span class="n">item_type</span> <span class="ow">in</span> <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span>
            <span class="n">label_on</span> <span class="o">=</span> <span class="n">item_type</span> <span class="ow">in</span> <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="n">item_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot_on</span> <span class="ow">and</span> <span class="n">label_on</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">color_plot</span> <span class="ow">and</span> <span class="n">item_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;areas&#39;</span><span class="p">,</span> <span class="s1">&#39;parts&#39;</span><span class="p">]:</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="n">colormaker</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">plot_on</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">color_plot</span> <span class="ow">and</span> <span class="n">item_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;areas&#39;</span><span class="p">,</span> <span class="s1">&#39;parts&#39;</span><span class="p">]:</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="n">colormaker</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">label_on</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

        <span class="c1"># set the horizontal and vertical axes</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">points</span>
        <span class="n">radials</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">axials</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_set_bounds</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">axials</span><span class="p">,</span> <span class="n">radials</span><span class="p">)</span>

        <span class="c1"># set units</span>
        <span class="p">[</span><span class="n">d_unit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="s1">&#39;dist&#39;</span><span class="p">)</span>

        <span class="c1"># show plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;axial, y&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;radial, x&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">base_classes</span><span class="o">.</span><span class="n">plot_finish</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_parts"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_parts">[docs]</a>    <span class="k">def</span> <span class="nf">plot_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Parts&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots selected parts</span>

<span class="sd">        Defaults to displaying labels on: parts and filling all part areas.</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): png image file prefix, if given, image will be saved</span>
<span class="sd">            display (bool): if True, interactive plot will be shown, if False</span>
<span class="sd">                plot will not be shown. Default = True</span>
<span class="sd">            title (str): the plot&#39;s title</span>
<span class="sd">            label (bool): if True all Part objects will be labeled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="s1">&#39;parts&#39;</span>
        <span class="n">styledict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;items&#39;</span><span class="p">:[],</span> <span class="s1">&#39;labels&#39;</span><span class="p">:[]}</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_multiple</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">styledict</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_areas"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_areas">[docs]</a>    <span class="k">def</span> <span class="nf">plot_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Areas&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots selected areas</span>

<span class="sd">        Defaults to displaying labels on: areas and filling all part areas.</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): png image file prefix, if given, image will be saved</span>
<span class="sd">            display (bool): if True, interactive plot will be shown, if False</span>
<span class="sd">                plot will not be shown. Default = True</span>
<span class="sd">            title (str): the plot&#39;s title</span>
<span class="sd">            label (bool): if True all areas will be labeled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="s1">&#39;areas&#39;</span>
        <span class="n">styledict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;items&#39;</span><span class="p">:[],</span> <span class="s1">&#39;labels&#39;</span><span class="p">:[]}</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_multiple</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">styledict</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_lines"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_lines">[docs]</a>    <span class="k">def</span> <span class="nf">plot_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Lines&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots selected lines and arcs</span>

<span class="sd">        Defaults to displaying labels on: lines and arcs</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): png image file prefix, if given, image will be saved</span>
<span class="sd">            display (bool): if True, interactive plot will be shown, if False</span>
<span class="sd">                plot will not be shown. Default = True</span>
<span class="sd">            title (str): the plot&#39;s title</span>
<span class="sd">            label (bool): if True all lines and arcs will be labeled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="s1">&#39;lines&#39;</span>
        <span class="n">styledict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;items&#39;</span><span class="p">:[],</span> <span class="s1">&#39;labels&#39;</span><span class="p">:[]}</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_multiple</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">styledict</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_points"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_points">[docs]</a>    <span class="k">def</span> <span class="nf">plot_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Points&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots selected points</span>

<span class="sd">        Defaults to displaying labels on: points</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): png image file prefix, if given, image will be saved</span>
<span class="sd">            display (bool): if True, interactive plot will be shown, if False</span>
<span class="sd">                plot will not be shown. Default = True</span>
<span class="sd">            title (str): the plot&#39;s title</span>
<span class="sd">            label (bool): if True all points will be labeled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="s1">&#39;points&#39;</span>
        <span class="n">styledict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;items&#39;</span><span class="p">:[],</span> <span class="s1">&#39;labels&#39;</span><span class="p">:[]}</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_multiple</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">styledict</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaModel.plot_geometry"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.plot_geometry">[docs]</a>    <span class="k">def</span> <span class="nf">plot_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Geometry&#39;</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">lnum</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">anum</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">afill</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots selected geometry items: areas, lines, points.</span>

<span class="sd">        Defaults to displaying labels on: areas, lines, and points, and filling</span>
<span class="sd">        in the areas.</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): png image file prefix, if given, image will be saved</span>
<span class="sd">            display (bool): if True, interactive plot will be shown, if False</span>
<span class="sd">                plot will not be shown. Default = True</span>
<span class="sd">            title (str): the plot&#39;s title</span>
<span class="sd">            pnum (bool): if True all Point objects will be labeled</span>
<span class="sd">            lnum (bool): if True all Line and Arc objects will be labeled</span>
<span class="sd">            anum (bool): if True all Area objects will be labeled</span>
<span class="sd">            afill (bool): if True all Area objects will be filled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">styledict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;items&#39;</span><span class="p">:[],</span> <span class="s1">&#39;labels&#39;</span><span class="p">:[]}</span>
        <span class="k">if</span> <span class="n">pnum</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;points&#39;</span><span class="p">)</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;points&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lnum</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;lines&#39;</span><span class="p">)</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;lines&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">anum</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;areas&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">afill</span><span class="p">:</span>
                <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;areas&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">anum</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">afill</span><span class="p">:</span>
            <span class="n">styledict</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;areas&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_multiple</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">styledict</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a component name prefix, for labeling lists of items.</span>

<span class="sd">        Args:</span>
<span class="sd">            items (list): a list of the items we&#39;ll be making a component of</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">cname</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cname</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cname</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cname</span>

    <span class="k">def</span> <span class="nf">__get_make_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stores component if it doesn&#39;t exist, returns it if it does.</span>

<span class="sd">        Args:</span>
<span class="sd">            comp (Component): component we want to store/get</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">comp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">comp</span>

    <span class="k">def</span> <span class="nf">__get_make_surfint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surfint</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stores surfac interaction if it doesn&#39;t exist, returns it if it does.</span>

<span class="sd">        Args:</span>
<span class="sd">            surfint (connectors.SurfaceInteraction): item to get or make</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfints</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">int_type</span> <span class="o">==</span> <span class="n">surfint</span><span class="o">.</span><span class="n">int_type</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">surfint</span><span class="o">.</span><span class="n">int_type</span> <span class="o">==</span> <span class="s1">&#39;LINEAR&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">k</span> <span class="o">==</span> <span class="n">surfint</span><span class="o">.</span><span class="n">k</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">item</span>
        <span class="k">elif</span> <span class="n">surfint</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;EXPONENTIAL&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">c0</span> <span class="o">==</span> <span class="n">surfint</span><span class="o">.</span><span class="n">c0</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">p0</span> <span class="o">==</span> <span class="n">surfint</span><span class="o">.</span><span class="n">p0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">item</span>
        <span class="n">surfint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surfint</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">surfint</span>

<div class="viewcode-block" id="FeaModel.register"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds an item to the feamodel.</span>

<span class="sd">        Item is added to the correct list and its id is updated.</span>
<span class="sd">        Allowed Items:</span>

<span class="sd">        * Point</span>
<span class="sd">        * Line</span>
<span class="sd">        * Arc</span>
<span class="sd">        * SignLine</span>
<span class="sd">        * SignArc</span>
<span class="sd">        * LineLoop</span>
<span class="sd">        * Area</span>
<span class="sd">        * Part</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">class_to_list</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Point&#39;</span><span class="p">:</span> <span class="s1">&#39;points&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Line&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Arc&#39;</span><span class="p">:</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;SignLine&#39;</span><span class="p">:</span> <span class="s1">&#39;signlines&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;SignArc&#39;</span><span class="p">:</span> <span class="s1">&#39;signlines&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;LineLoop&#39;</span><span class="p">:</span> <span class="s1">&#39;lineloops&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Area&#39;</span><span class="p">:</span> <span class="s1">&#39;areas&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Part&#39;</span><span class="p">:</span> <span class="s1">&#39;parts&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="n">class_to_list</span><span class="p">:</span>
            <span class="n">list_name</span> <span class="o">=</span> <span class="n">class_to_list</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_name</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: the item you passed must be a geometry item!&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You passed a </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">class_name</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Allowed items: Point, Line, Arc, SignLine, SignArc, &quot;</span>
                       <span class="s2">&quot;LineLoop, Area, Part&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__add_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a load to the FeaModel.</span>

<span class="sd">        Args:</span>
<span class="sd">            load (Load or Load_Linear): th eload to add</span>
<span class="sd">            time (float): the load&#39;s time point. The first time point is 1.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">load</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">load</span>

<div class="viewcode-block" id="FeaModel.scale"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitstr</span><span class="p">,</span> <span class="n">point_first</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point_last</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Scales the points from [point_first, ..., point_last] using unitstr</span>

<span class="sd">        If point_first and point_last are both None, all points are scaled.</span>

<span class="sd">        Args:</span>
<span class="sd">            unitstr (str): string scalar &#39;fromunit-tounit&#39; using the below units:</span>

<span class="sd">                * mm, m, in, ft</span>
<span class="sd">                * Examples &#39;mm-m&#39; &#39;m-in&#39; &#39;ft-mm&#39; &#39;in-ft&#39;</span>
<span class="sd">                * Default value is &#39;&#39; and does not apply a scale factor</span>

<span class="sd">            point_first (Point or None or str): the first point to scale,</span>
<span class="sd">                string point names may be passed</span>
<span class="sd">            point_last (Point or None or str): the last point to scale,</span>
<span class="sd">                string point names may be passed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># convert to points if passing in string point names &#39;P0&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point_first</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">point_first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">point_first</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point_last</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">point_last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">point_last</span><span class="p">)</span>

        <span class="n">ind_first</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">point_first</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind_first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">point_first</span><span class="p">)</span>
        <span class="n">ind_last</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">point_last</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind_last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">point_last</span><span class="p">)</span>

        <span class="n">unit_size</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;mm&#39;</span><span class="p">:</span><span class="o">.</span><span class="mi">001</span><span class="p">,</span> <span class="s1">&#39;ft&#39;</span><span class="p">:</span><span class="o">.</span><span class="mi">3048</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span><span class="mf">0.0254</span><span class="p">}</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">unitstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">from_unit</span><span class="p">,</span> <span class="n">to_unit</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">units</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">scalar</span> <span class="o">=</span> <span class="n">unit_size</span><span class="p">[</span><span class="n">from_unit</span><span class="p">]</span><span class="o">/</span><span class="n">unit_size</span><span class="p">[</span><span class="n">to_unit</span><span class="p">]</span></div>
        <span class="c1"># scale all points in set</span>
        <span class="c1"># update all dependent arcs</span>
        <span class="c1"># update all dependent line loops</span>
        <span class="c1"># update all dependent areas</span>
        <span class="c1"># update all dependent parts</span>

<div class="viewcode-block" id="FeaModel.set_gravity"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_gravity">[docs]</a>    <span class="k">def</span> <span class="nf">set_gravity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets gravity on the elements in items.</span>

<span class="sd">        Assumes gravity acts in the -x direction with magnitude grav.</span>

<span class="sd">        Args:</span>
<span class="sd">            grav (float): gravity acceleration, MUST BE POSTIVE</span>
<span class="sd">            items (Area or Part or list): items gravity acts on</span>

<span class="sd">                - Area: gravity acts on elements in this area</span>
<span class="sd">                - Part: gravity acts on elements in this part</span>
<span class="sd">                - list of Part or Area: gravity acts on their elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;elements&#39;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

        <span class="c1"># make compoenet</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="c1"># make load</span>
        <span class="n">ltype</span> <span class="o">=</span> <span class="s1">&#39;gravity&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">ConstLoad</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">grav</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load</span></div>

<div class="viewcode-block" id="FeaModel.set_rpm"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_rpm">[docs]</a>    <span class="k">def</span> <span class="nf">set_rpm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets rpm rotation load on the items.</span>

<span class="sd">        Args:</span>
<span class="sd">            rpm (float): rotation per minute</span>
<span class="sd">            items (Area or Part or list): items rotation acts on</span>

<span class="sd">                - Area: rotation acts on elements in this area</span>
<span class="sd">                - Part: rotation acts on elements in this part</span>
<span class="sd">                - list of Part or Area: rotation acts on their elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># applies rpm to the items</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;elements&#39;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

        <span class="c1"># make compoenet</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="c1"># make load</span>
        <span class="n">ltype</span> <span class="o">=</span> <span class="s1">&#39;rpm&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">ConstLoad</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">rpm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load</span></div>

<div class="viewcode-block" id="FeaModel.set_radps"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_radps">[docs]</a>    <span class="k">def</span> <span class="nf">set_radps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radps</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets radians per second rotation load on the items.</span>

<span class="sd">        Args:</span>
<span class="sd">            radps (float): radians per second</span>
<span class="sd">            items (Area or Part or list): items rotation acts on</span>

<span class="sd">                - Area: rotation acts on elements in this area</span>
<span class="sd">                - Part: rotation acts on elements in this part</span>
<span class="sd">                - list of Part or Area: rotation acts on their elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;elements&#39;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

        <span class="c1"># make compoenet</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="c1"># make load</span>
        <span class="n">ltype</span> <span class="o">=</span> <span class="s1">&#39;radps&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">ConstLoad</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">radps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load</span></div>

<div class="viewcode-block" id="FeaModel.set_fluid_press"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_fluid_press">[docs]</a>    <span class="k">def</span> <span class="nf">set_fluid_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">xo</span><span class="p">,</span> <span class="n">po</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This sets a fluid presure load on items.</span>

<span class="sd">        This fluid pressure is dependednt on the x axis.</span>
<span class="sd">        g must be positive.</span>

<span class="sd">            - P = f(x)</span>
<span class="sd">            - P(xo) = po</span>
<span class="sd">            - P(x) = po + rho*g*(xo - x)</span>

<span class="sd">        Args:</span>
<span class="sd">            items (str or Line or Arc or list): items to set pressure on</span>

<span class="sd">                - str: string name of Line or Arc item, for example &#39;L0&#39;</span>
<span class="sd">                - Line or Arc: set presssure on this</span>
<span class="sd">                - list or Line or Arc: set pressure on these</span>
<span class="sd">            rho (float): fluid density in mass/volume</span>
<span class="sd">            g (+float): gravity in dist/(t^2), MUST BE POSITIVE</span>
<span class="sd">            xo (float): sea level height, MUST BE POSITIVE</span>
<span class="sd">            po (float): sea level pressure, MUST BE POSITIVE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;faces&#39;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

        <span class="c1"># make compoenet</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="c1"># make load</span>
        <span class="n">ltype</span> <span class="o">=</span> <span class="s1">&#39;press_fluid&#39;</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="n">g</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">LinearLoad</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">xo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load</span></div>

<div class="viewcode-block" id="FeaModel.set_load"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_load">[docs]</a>    <span class="k">def</span> <span class="nf">set_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltype</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">lval</span><span class="p">,</span> <span class="n">ldir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a pressure or force load on line(s).</span>

<span class="sd">        The force load is divided by the number of nodes and applied on</span>
<span class="sd">        each node.</span>

<span class="sd">        The pressure load is applied to the child faces under the line.</span>
<span class="sd">        Positive is compression, negative is tension.</span>

<span class="sd">        Args:</span>
<span class="sd">            ltype (str): &#39;press&#39; or &#39;force&#39;</span>
<span class="sd">            items (str or Line or Arc or list): items to set load on</span>

<span class="sd">                - str: string name of Line or Arc item, for example &#39;L0&#39;</span>
<span class="sd">                - Line or Arc: set load on this</span>
<span class="sd">                - list or Line or Arc: set load on these</span>
<span class="sd">            lval (float): load value.</span>

<span class="sd">                - For ltype = &#39;press&#39; this is in force/area units</span>
<span class="sd">                - For ltype = &#39;force&#39; this is in force units</span>
<span class="sd">            ldir (None or str): load direction. Defaults to None</span>

<span class="sd">                - str: when ltype=&#39;load&#39;, we need to set ldir to &#39;x&#39; or &#39;y&#39;</span>
<span class="sd">                - None: when ltype=&#39;press&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;nodes&#39;</span>
        <span class="k">if</span> <span class="n">ltype</span> <span class="o">==</span> <span class="s1">&#39;press&#39;</span><span class="p">:</span>
            <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;faces&#39;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

        <span class="c1"># make compoenet</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="c1"># make load</span>
        <span class="k">if</span> <span class="n">ltype</span> <span class="o">==</span> <span class="s1">&#39;force&#39;</span><span class="p">:</span>
            <span class="n">ltype</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span><span class="o">+</span><span class="n">ldir</span> <span class="c1"># for example fx</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">ConstLoad</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">lval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load</span></div>

<div class="viewcode-block" id="FeaModel.set_constr"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_constr">[docs]</a>    <span class="k">def</span> <span class="nf">set_constr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltype</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a displacement constraint on the passed item(s).</span>

<span class="sd">        Args:</span>
<span class="sd">            ltype (str): &#39;fix&#39; or &#39;displ&#39;</span>

<span class="sd">                - &#39;fix&#39;: val arg should not be passed</span>
<span class="sd">                - &#39;displ&#39;: val arg must be passed</span>
<span class="sd">            items (str, SignLine, SignArc, Point or list): item(s) to apply the</span>
<span class="sd">                constraint on</span>

<span class="sd">                - str: this string must be a line or point name</span>
<span class="sd">                - SignLine or SignArc: the constraint will be applied</span>
<span class="sd">                    to this item</span>
<span class="sd">                - Point: the constraint will be applied on this item</span>
<span class="sd">                - list of SignLine or SignArc: the constraint will be appplied</span>
<span class="sd">                    on these</span>
<span class="sd">                - list of Point: the constraint will be appplied on these</span>
<span class="sd">                - list of str names: pass line or point names, constr</span>
<span class="sd">                    applied on them</span>

<span class="sd">            axis (str): load axis, &#39;x&#39; or &#39;y&#39;</span>
<span class="sd">            val (float): displacement value, defaults to 0.0, only needs to be</span>
<span class="sd">                set when ltype = &#39;displ&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;nodes&#39;</span>

        <span class="c1"># make compoenet</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="c1"># make load</span>
        <span class="n">ltype</span> <span class="o">=</span> <span class="s1">&#39;u&#39;</span><span class="o">+</span><span class="n">axis</span> <span class="c1"># for example ux</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">ConstLoad</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load</span></div>

<div class="viewcode-block" id="FeaModel.set_contact_linear"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_contact_linear">[docs]</a>    <span class="k">def</span> <span class="nf">set_contact_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master_lines</span><span class="p">,</span> <span class="n">slave_lines</span><span class="p">,</span> <span class="n">kval</span><span class="p">,</span> <span class="n">many_si</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets contact between master and slave lines.</span>

<span class="sd">        Slave lines are on the more compliant or more curved object.</span>

<span class="sd">        Args:</span>
<span class="sd">            master_lines (list): list of SignLine or SignArc</span>
<span class="sd">            slave_lines (list): list of SignLine or SignArc</span>
<span class="sd">            kval (float): stiffness, 5 to 50 times the youngs modulus</span>
<span class="sd">                of the touching matl</span>
<span class="sd">            many_si (bool): True, make unique surface interaction for every contact</span>
<span class="sd">                False, use existing surface interaction if we can</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">master_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">master_lines</span><span class="p">)</span>
        <span class="n">master_cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">master_items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;faces&#39;</span>
        <span class="n">master_comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">master_items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">master_cname</span><span class="p">)</span>
        <span class="n">master_comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">master_comp</span><span class="p">)</span>

        <span class="n">slave_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">slave_lines</span><span class="p">)</span>
        <span class="n">slave_cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">slave_items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;faces&#39;</span>
        <span class="n">slave_comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">slave_items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">slave_cname</span><span class="p">)</span>
        <span class="n">slave_comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">slave_comp</span><span class="p">)</span>

        <span class="n">surf_int</span> <span class="o">=</span> <span class="n">connectors</span><span class="o">.</span><span class="n">SurfaceInteraction</span><span class="p">(</span><span class="s1">&#39;LINEAR&#39;</span><span class="p">,</span> <span class="n">kval</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">many_si</span><span class="p">:</span>
            <span class="n">surf_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surf_int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">surf_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_surfint</span><span class="p">(</span><span class="n">surf_int</span><span class="p">)</span>

        <span class="n">cont</span> <span class="o">=</span> <span class="n">connectors</span><span class="o">.</span><span class="n">Contact</span><span class="p">(</span><span class="n">master_comp</span><span class="p">,</span> <span class="n">slave_comp</span><span class="p">,</span> <span class="n">surf_int</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span></div>


<div class="viewcode-block" id="FeaModel.set_eshape"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_eshape">[docs]</a>    <span class="k">def</span> <span class="nf">set_eshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eshape</span><span class="o">=</span><span class="s1">&#39;quad&#39;</span><span class="p">,</span> <span class="n">eorder</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the element shape and order to use when meshing the model.</span>

<span class="sd">        Args:</span>
<span class="sd">            eshape (str): element shape</span>

<span class="sd">                - &#39;quad&#39;: quadrilaterials</span>
<span class="sd">                - &#39;tri&#39;: triangles</span>
<span class="sd">            eorder (int): element order, default=2</span>

<span class="sd">                - 1: corner nodes only (3 and 4 noded elements)</span>
<span class="sd">                - 2: corder nodes and midside nodes (6 and 8 noded elements)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span> <span class="o">=</span> <span class="n">eshape</span> <span class="c1"># quad or tri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eorder</span> <span class="o">=</span> <span class="n">eorder</span> <span class="c1"># 1 or 2</span></div>

<div class="viewcode-block" id="FeaModel.set_etype"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_etype">[docs]</a>    <span class="k">def</span> <span class="nf">set_etype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">thick</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the element type, and thickness on areas or parts.</span>

<span class="sd">        Args:</span>
<span class="sd">            etype (str): element type</span>

<span class="sd">                - &#39;plstress&#39;: plane stress</span>
<span class="sd">                - &#39;plstrain&#39;: plane strain</span>
<span class="sd">                - &#39;axisym&#39;: axisymmetric</span>
<span class="sd">            items (str or Area or Part or list): set element type on these</span>

<span class="sd">                - str: string name of Area or Part item. Example: &#39;A0&#39;, &#39;PART0&#39;</span>
<span class="sd">                - Area: set element type on the elements in this area</span>
<span class="sd">                - Part: set element type on the elements in this part</span>
<span class="sd">                - list of Area or Part: set element type on their elements</span>
<span class="sd">            thick (float or None): element thickness</span>

<span class="sd">                - None: default, used for axisymmetric element type</span>
<span class="sd">                - float: thickness value to use for plane stress or plane</span>
<span class="sd">                    strain elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

        <span class="c1"># set the element types on the areas, this is used to fix</span>
        <span class="c1"># elements when importing them from the inp file</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Area</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">set_etype</span><span class="p">(</span><span class="n">etype</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">partmodule</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
                    <span class="n">area</span><span class="o">.</span><span class="n">set_etype</span><span class="p">(</span><span class="n">etype</span><span class="p">)</span>

        <span class="c1"># set a thickness component if needed</span>
        <span class="k">if</span> <span class="n">etype</span> <span class="o">!=</span> <span class="s1">&#39;axisym&#39;</span> <span class="ow">and</span> <span class="n">thick</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># make component for element thickness</span>
            <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;nodes&#39;</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

            <span class="c1"># add load</span>
            <span class="n">ltype</span> <span class="o">=</span> <span class="s1">&#39;nodal_thickness&#39;</span>
            <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">ConstLoad</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">thick</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">load</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FeaModel.set_matl"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.set_matl">[docs]</a>    <span class="k">def</span> <span class="nf">set_matl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matl</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the material on Part or Area items.</span>

<span class="sd">        Args:</span>
<span class="sd">            matl (Material): material to assign to items</span>
<span class="sd">            items (Part or Area or list): items that will have matl assigned</span>

<span class="sd">                - Part: assign matl to this</span>
<span class="sd">                - Area: assign matl to this</span>
<span class="sd">                - list of Area or Part: assign matl to these</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

        <span class="c1"># store the material if it&#39;s not already</span>
        <span class="k">if</span> <span class="n">matl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matls</span><span class="p">:</span>
            <span class="n">matl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matl</span><span class="p">)</span>

        <span class="c1"># make component</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;elements&#39;</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_make_comp</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="c1"># make load</span>
        <span class="n">ltype</span> <span class="o">=</span> <span class="s1">&#39;matl&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">ConstLoad</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">matl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load</span></div>

    <span class="k">def</span> <span class="nf">__read_inp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads in the mesh from a Calculix inp file.</span>

<span class="sd">        All nodes, elements, and faces are read. Child nodes, elements and</span>
<span class="sd">        faces are assigned to their geometry parents (points, lines, arcs,</span>
<span class="sd">        areas, parts.</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): file name to read, must include &#39;.inp&#39; extension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">set_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">set_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># holder for nodes or elements in nsets or esets</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Meshlist</span><span class="p">()</span> <span class="c1"># store nodes</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Meshlist</span><span class="p">()</span> <span class="c1"># store elements, allows renumbering before putting int model</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># store faces</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;E&#39;</span><span class="p">:{},</span> <span class="s1">&#39;N&#39;</span><span class="p">:{}}</span> <span class="c1"># store sets</span>
        <span class="n">etype</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">Dict_NodeIDs</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">Dict_ElemIDs</span><span class="o">=</span><span class="p">{}</span>

        <span class="c1"># read in input file</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;nmake&#39;</span><span class="p">:</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
                    <span class="p">(</span><span class="n">nnum</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">nnum</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                    <span class="n">N</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="n">Dict_NodeIDs</span><span class="p">[</span><span class="n">nnum</span><span class="p">]</span><span class="o">=</span><span class="n">node</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;emake&#39;</span><span class="p">:</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
                    <span class="n">enum</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">nlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dict_NodeIDs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">enum</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">nlist</span><span class="p">)</span>
                    <span class="n">faces</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">faces</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="n">Dict_ElemIDs</span><span class="p">[</span><span class="n">enum</span><span class="p">]</span><span class="o">=</span><span class="n">e</span>
                    <span class="n">F</span> <span class="o">+=</span> <span class="n">faces</span>
                    <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">:</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span> <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
                    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">set_type</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dict_ElemIDs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">Dict_ElemIDs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="k">elif</span> <span class="n">set_type</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>
                        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dict_NodeIDs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">items</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                        <span class="k">pass</span> <span class="c1"># the elements were not found</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">items</span>

            <span class="c1"># mode setting</span>
            <span class="k">if</span> <span class="s1">&#39;*Node&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s1">&#39;*NODE&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;nmake&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;*Element&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s1">&#39;*ELEMENT&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="c1"># split it based on commas</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">etype</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># exclude T elements made in gmsh</span>
                <span class="k">if</span> <span class="n">etype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">set_name</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">set_type</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
                    <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;emake&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="s1">&#39;*ELSET&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">set_name</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">set_type</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
                <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;set&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;*NSET&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">set_name</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">set_type</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
                <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;set&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># loop through sets and remove empty sets</span>
        <span class="c1"># store sets to delete</span>
        <span class="n">todel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">set_type</span><span class="p">,</span> <span class="n">set_dict</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">set_name</span><span class="p">,</span> <span class="n">item_list</span><span class="p">)</span> <span class="ow">in</span> <span class="n">set_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">item_list</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">todel</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;set_type&#39;</span><span class="p">:</span><span class="n">set_type</span><span class="p">,</span> <span class="s1">&#39;set_name&#39;</span><span class="p">:</span><span class="n">set_name</span><span class="p">})</span>
        <span class="c1"># delete the empty sets</span>
        <span class="k">for</span> <span class="n">adict</span> <span class="ow">in</span> <span class="n">todel</span><span class="p">:</span>
            <span class="p">(</span><span class="n">set_type</span><span class="p">,</span> <span class="n">set_name</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">adict</span><span class="p">[</span><span class="s1">&#39;set_type&#39;</span><span class="p">],</span> <span class="n">adict</span><span class="p">[</span><span class="s1">&#39;set_name&#39;</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span>
            <span class="c1">#print(&#39;Empty set type:%s name:%s deleted&#39; % (set_type, set_name))</span>

        <span class="c1"># this resets the min element to number 1</span>
        <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">get_minid</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">E</span><span class="o">.</span><span class="n">set_minid</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#-----------------------------------</span>
        <span class="c1"># Node and element assignment back onto parts, areas, lines, points</span>
        <span class="c1">#-----------------------------------</span>
        <span class="c1"># assign elements + nodes to feamodel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span> <span class="o">=</span> <span class="n">F</span>

        <span class="c1"># remove arc center nodes from imported node set</span>
        <span class="c1"># those nodes have no elements under them</span>
        <span class="n">torem</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">N</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">torem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">torem</span><span class="p">:</span>
            <span class="n">N</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="c1"># assign nodes to feamodel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">N</span>

        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="c1"># assign part element and node sets</span>
            <span class="n">pname</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">part</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="n">pname</span><span class="p">]</span>
            <span class="n">part</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">][</span><span class="n">pname</span><span class="p">]</span>

            <span class="c1"># assign all nodes and elements to areas, fix the element types</span>
            <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
                <span class="n">aname</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="n">area</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="n">aname</span><span class="p">]</span>
                <span class="n">area</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">][</span><span class="n">aname</span><span class="p">]</span>
                <span class="n">area</span><span class="o">.</span><span class="n">set_child_ccxtypes</span><span class="p">()</span> <span class="c1">#paint element types on elements</span>

            <span class="c1"># assign the child nodes to points</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">points</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="n">ndist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="n">p_tmp</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">point</span> <span class="o">-</span> <span class="n">p_tmp</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
                    <span class="n">ndist</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;dist&#39;</span><span class="p">:</span><span class="n">dist</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span><span class="n">node</span><span class="p">})</span>
                <span class="c1"># sort the list by dist, sorts low to high</span>
                <span class="n">ndist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ndist</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">])</span>
                <span class="n">point</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ndist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;node&#39;</span><span class="p">]]</span>
                <span class="c1">#print(&#39;Point %s = node %s&#39; % (pt, pt.nodes))</span>

            <span class="c1"># assign the nodes and n1 and faces to lines</span>
            <span class="n">slines</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">signlines</span>
            <span class="k">for</span> <span class="n">sline</span> <span class="ow">in</span> <span class="n">slines</span><span class="p">:</span>
                <span class="n">lname</span> <span class="o">=</span> <span class="n">sline</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="n">area</span> <span class="o">=</span> <span class="n">sline</span><span class="o">.</span><span class="n">lineloop</span><span class="o">.</span><span class="n">parent</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">][</span><span class="n">sline</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">sline</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span>
                <span class="n">sline</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="n">n1</span>
                <span class="c1"># make a set of all faces that contain the line&#39;s node</span>
                <span class="n">allfaces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="n">allfaces</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
                <span class="c1"># make a set of all faces on the line only</span>
                <span class="n">linefaces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">allfaces</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodes</span><span class="p">)):</span>
                        <span class="n">linefaces</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
                <span class="c1"># and only the ones whose element centers are in the area</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">linefaces</span><span class="p">:</span>
                    <span class="n">is_lineface</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">contains_point</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">is_lineface</span><span class="p">:</span>
                        <span class="n">faces</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
                <span class="n">sline</span><span class="o">.</span><span class="n">faces</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Elements: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nodes: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done reading Calculix/Abaqus .inp file&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="FeaModel.mesh"><a class="viewcode-back" href="../../pycalculix.html#pycalculix.feamodel.FeaModel.mesh">[docs]</a>    <span class="k">def</span> <span class="nf">mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">meshmode</span><span class="o">=</span><span class="s1">&#39;fineness&#39;</span><span class="p">,</span> <span class="n">mesher</span><span class="o">=</span><span class="s1">&#39;gmsh&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Meshes all parts.</span>

<span class="sd">        Args:</span>
<span class="sd">            size (float):</span>

<span class="sd">                - if meshmode == &#39;fineness&#39; (default):</span>
<span class="sd">                    - mesh size is adapted to geometry size</span>
<span class="sd">                    - set size = 0.0001 - 1.0, to define how fine the mesh is.</span>
<span class="sd">                    - Low numbers are very fine, higher numbers are coarser.</span>

<span class="sd">                - if meshmode == &#39;esize&#39;:</span>
<span class="sd">                    - element size is kept constant</span>
<span class="sd">                    - choose it depending on geometry size</span>
<span class="sd">                    - it should be reduced e.g. at arcs with small radius, by calling line.esize function</span>

<span class="sd">            meshmode (str):</span>

<span class="sd">                - &#39;fineness&#39;: adapt mesh size to geometry</span>
<span class="sd">                - &#39;esize&#39;: keep explicitly defined element size</span>

<span class="sd">                meshmode is changed to &#39;esize&#39; is used if esize property is set to points or lines</span>

<span class="sd">            mesher (str): the mesher to use</span>

<span class="sd">                - &#39;gmsh&#39;: mesh with Gmsh, this is reccomended, it allows holes</span>
<span class="sd">                - &#39;cgx&#39;: mesh with Calculix cgx, it doesn&#39;t allow holes</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="c1">#check if element size is set to points and change meshmode if necessary</span>
        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pt</span><span class="o">.</span><span class="n">esize</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">meshmode</span><span class="o">==</span><span class="s1">&#39;fineness&#39;</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;meshmode is changed to esize, because elementsize was defined on points!&#39;</span><span class="p">)</span>
                <span class="n">meshmode</span> <span class="o">=</span> <span class="s1">&#39;esize&#39;</span>


        <span class="c1">#if meshmode esize is chosen: ediv&#39;s on lines and arcs are transformed to element sizes on start and end point</span>
        <span class="k">if</span> <span class="n">meshmode</span> <span class="o">==</span> <span class="s1">&#39;esize&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">ediv</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_esize</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">length</span><span class="p">()</span><span class="o">/</span><span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="p">)</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_esize</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">length</span><span class="p">()</span><span class="o">/</span><span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">mesher</span> <span class="o">==</span> <span class="s1">&#39;gmsh&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__mesh_gmsh</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">meshmode</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mesher</span> <span class="o">==</span> <span class="s1">&#39;cgx&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__mesh_cgx</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__mesh_gmsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">meshmode</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Meshes all parts using the Gmsh mesher.</span>

<span class="sd">        Args:</span>

<span class="sd">            size (float):</span>

<span class="sd">                - if meshmode == &#39;fineness&#39; (default):</span>
<span class="sd">                    - mesh size is adapted to geometry size</span>
<span class="sd">                    - set size = 0.0001 - 1.0, to define how fine the mesh is.</span>
<span class="sd">                    - Low numbers are very fine, higher numbers are coarser.</span>

<span class="sd">                - if meshmode == &#39;esize&#39;:</span>
<span class="sd">                    - element size is kept constant</span>
<span class="sd">                    - choose it depending on geometry size</span>

<span class="sd">            meshmode (str):</span>

<span class="sd">                - &#39;fineness&#39;: adapt mesh size to geometry</span>
<span class="sd">                - &#39;esize&#39;: keep explicitly defined element size</span>

<span class="sd">            timeout (int): time in seconds before the process throws a</span>
<span class="sd">                subprocess.TimeoutExpired</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geo</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ids</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ids</span><span class="p">[</span><span class="s1">&#39;plane_surface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># write all points</span>
        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="n">txtline</span> <span class="o">=</span> <span class="s1">&#39;Point(</span><span class="si">%i</span><span class="s1">) = {</span><span class="si">%f</span><span class="s1">, </span><span class="si">%f</span><span class="s1">, </span><span class="si">%f</span><span class="s1">};&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">meshmode</span> <span class="o">==</span> <span class="s1">&#39;esize&#39;</span><span class="p">:</span>
                <span class="c1">#add element size to points</span>
                <span class="k">if</span> <span class="n">pt</span><span class="o">.</span><span class="n">esize</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">txtline</span> <span class="o">=</span> <span class="n">txtline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;, </span><span class="si">%f</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">size</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span><span class="o">==</span><span class="s1">&#39;tri&#39;</span> <span class="k">else</span> <span class="n">size</span><span class="o">*</span><span class="mf">2.</span><span class="p">))</span>
                    <span class="c1">#txtline = txtline.replace(&#39;}&#39;, &#39;, %f}&#39; % (size))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txtline</span> <span class="o">=</span> <span class="n">txtline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;, </span><span class="si">%f</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">esize</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span><span class="o">==</span><span class="s1">&#39;tri&#39;</span> <span class="k">else</span> <span class="n">pt</span><span class="o">.</span><span class="n">esize</span><span class="o">*</span><span class="mf">2.</span><span class="p">))</span>
                    <span class="c1">#txtline = txtline.replace(&#39;}&#39;, &#39;, %f}&#39; % (pt.esize))</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txtline</span><span class="p">)</span>

        <span class="c1"># start storing an index number</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># write all lines</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">lnum</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">id</span>
            <span class="n">ids</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">][</span><span class="n">lnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind</span>
            <span class="n">pt1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">id</span>
            <span class="n">pt2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">id</span>
            <span class="n">txtline</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Arc</span><span class="p">):</span>
                <span class="n">ctr</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">actr</span><span class="o">.</span><span class="n">id</span>
                <span class="n">txtline</span> <span class="o">=</span> <span class="s1">&#39;Circle(</span><span class="si">%i</span><span class="s1">) = {</span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">};&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">ctr</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txtline</span> <span class="o">=</span> <span class="s1">&#39;Line(</span><span class="si">%i</span><span class="s1">) = {</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">};&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txtline</span><span class="p">)</span>

            <span class="c1"># set division if we have it</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">ediv</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">meshmode</span><span class="o">==</span><span class="s1">&#39;fineness&#39;</span><span class="p">:</span>
                <span class="n">ndiv</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">esize</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">length</span><span class="p">()</span><span class="o">/</span><span class="n">line</span><span class="o">.</span><span class="n">ediv</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span> <span class="o">==</span> <span class="s1">&#39;quad&#39;</span><span class="p">:</span>
                    <span class="n">ndiv</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">esize</span> <span class="o">=</span> <span class="n">esize</span><span class="o">*</span><span class="mi">2</span>
                    <span class="c1"># this is needed because quad recombine</span>
                    <span class="c1"># splits 1 element into 2</span>
                <span class="n">txtline</span> <span class="o">=</span> <span class="s1">&#39;Transfinite Line{</span><span class="si">%i</span><span class="s1">} = </span><span class="si">%i</span><span class="s1">;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">ndiv</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LINE ELEMENT SIZE: </span><span class="si">%f</span><span class="s1">, MAKES </span><span class="si">%i</span><span class="s1"> ELEMENTS&#39;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">length</span><span class="p">()</span><span class="o">/</span><span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="p">))</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txtline</span><span class="p">)</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Characteristic Length {</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">} = </span><span class="si">%f</span><span class="s1">;&#39;</span>
                           <span class="o">%</span> <span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">esize</span><span class="p">))</span>
            <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># write all areas</span>
        <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">id</span>
                <span class="n">aname</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="n">loop_ids</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">loops</span> <span class="o">=</span> <span class="p">[</span><span class="n">area</span><span class="o">.</span><span class="n">exlines</span><span class="p">]</span> <span class="o">+</span> <span class="n">area</span><span class="o">.</span><span class="n">holes</span>
                <span class="k">for</span> <span class="n">loop</span> <span class="ow">in</span> <span class="n">loops</span><span class="p">:</span>
                    <span class="n">txtline</span> <span class="o">=</span> <span class="s1">&#39;Line Loop(</span><span class="si">%i</span><span class="s1">) = &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                    <span class="n">loop_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>
                    <span class="n">line_ids</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">sline</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
                        <span class="n">lid</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">][</span><span class="n">sline</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">if</span> <span class="n">sline</span><span class="o">.</span><span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
                        <span class="n">line_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">lid</span><span class="p">))</span>
                    <span class="n">txtline</span> <span class="o">=</span> <span class="n">txtline</span> <span class="o">+</span> <span class="s1">&#39;{&#39;</span><span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_ids</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;};&#39;</span>
                    <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txtline</span><span class="p">)</span>
                    <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">loop_ids</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">loop_ids</span><span class="p">)</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Plane Surface(</span><span class="si">%i</span><span class="s1">) = {</span><span class="si">%s</span><span class="s1">};&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">loop_ids</span><span class="p">))</span>
                <span class="n">ids</span><span class="p">[</span><span class="s1">&#39;plane_surface&#39;</span><span class="p">][</span><span class="n">aid</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Physical Surface(&#39;</span><span class="si">%s</span><span class="s2">&#39;) = {</span><span class="si">%i</span><span class="s2">};&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aname</span><span class="p">,</span> <span class="n">ind</span><span class="p">))</span>
                <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># write part area components</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="c1"># make components for each part</span>
            <span class="n">txtline</span> <span class="o">=</span> <span class="s2">&quot;Physical Surface(&#39;</span><span class="si">%s</span><span class="s2">&#39;) = &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="n">area_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                    <span class="n">aid</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="s1">&#39;plane_surface&#39;</span><span class="p">][</span><span class="n">area</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                    <span class="n">area_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">aid</span><span class="p">))</span>
            <span class="n">txtline</span> <span class="o">=</span> <span class="n">txtline</span> <span class="o">+</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">area_ids</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;};&#39;</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txtline</span><span class="p">)</span>

        <span class="c1"># write all line componenets so we can get nodes out</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">][</span><span class="n">line</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="n">txtline</span> <span class="o">=</span> <span class="s2">&quot;Physical Line(&#39;</span><span class="si">%s</span><span class="s2">&#39;) = {</span><span class="si">%i</span><span class="s2">};&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">lid</span><span class="p">)</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txtline</span><span class="p">)</span>

        <span class="c1"># write node componenets</span>
        <span class="c1"># ERROR: node list is not produced by gmsh</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="n">pname</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">txtline</span> <span class="o">=</span> <span class="s2">&quot;Physical Point(&#39;</span><span class="si">%s</span><span class="s2">&#39;) = {</span><span class="si">%i</span><span class="s2">};&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pname</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txtline</span><span class="p">)</span>

        <span class="c1"># set the meshing options</span>
        <span class="k">if</span> <span class="n">meshmode</span> <span class="o">==</span> <span class="s1">&#39;fineness&#39;</span><span class="p">:</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.CharacteristicLengthFactor = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;; //mesh fineness&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.RecombinationAlgorithm = 1; //blossom&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span> <span class="o">==</span> <span class="s1">&#39;quad&#39;</span><span class="p">:</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.RecombineAll = 1; //turns on quads&#39;</span><span class="p">)</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.SubdivisionAlgorithm = 1; // quadrangles only&#39;</span><span class="p">)</span>
            <span class="c1">#geo.append(&#39;Mesh.RecombinationAlgorithm = 1; //turns on blossom needed for quad&#39;)</span>

        <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eorder</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.CharacteristicLengthExtendFromBoundary = 1;&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.CharacteristicLengthMin = 0;&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.CharacteristicLengthMax = 1e+022;&#39;</span><span class="p">)</span>
        <span class="c1"># use this so small circles are meshed finely</span>
        <span class="c1"># this is broken in Gmsh 4.3.0</span>
        <span class="c1"># geo.append(&#39;Mesh.CharacteristicLengthFromCurvature = 1;&#39;)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.CharacteristicLengthFromPoints = 1;&#39;</span><span class="p">)</span>
        <span class="c1"># geo.append(&#39;Mesh.Algorithm = 2; //delauny&#39;) #okay for quads</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.Algorithm = 8; //delquad = delauny for quads&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.ElementOrder = &#39;</span>
                   <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
                   <span class="o">+</span><span class="s1">&#39;; //linear or second set here&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.SecondOrderIncomplete=1; //no face node w/ 2nd order&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mesh.SaveGroupsOfNodes = 1; // save node groups&#39;</span><span class="p">)</span>

        <span class="c1"># write geo file to the local directory</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.geo&#39;</span>
        <span class="n">fout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.inp&#39;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">geo</span><span class="p">:</span>
            <span class="c1">#print (line)</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File: </span><span class="si">%s</span><span class="s1"> was written&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>

        <span class="c1"># run file in bg mode, -2 is 2d mesh, makes required inp file</span>
        <span class="n">runstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> -2 -o </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">GMSH</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">runstr</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">runstr</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File: </span><span class="si">%s</span><span class="s1"> was written&#39;</span> <span class="o">%</span> <span class="n">fout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Meshing done!&#39;</span><span class="p">)</span>

        <span class="c1"># write gmsh msh file, for manual checking only</span>
        <span class="c1"># not required by pycalculix</span>
        <span class="n">runstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> -2 -o </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">GMSH</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.msh&#39;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">runstr</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File: </span><span class="si">%s</span><span class="s1">.msh was written&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>

        <span class="c1"># read in the calculix mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_inp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.inp&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mesh_cgx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">meshmode</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Meshes all parts using the Calculix cgx mesher.</span>

<span class="sd">        Args:</span>

<span class="sd">            size (float):</span>

<span class="sd">                - if meshmode == &#39;fineness&#39; (default):</span>
<span class="sd">                    - mesh size is adapted to geometry size</span>
<span class="sd">                    - set size = 0.0001 - 1.0, to define how fine the mesh is.</span>
<span class="sd">                    - Low numbers are very fine, higher numbers are coarser.</span>

<span class="sd">                - if meshmode == &#39;esize&#39;:  NOT TESTED WITH CGX</span>
<span class="sd">                    - element size is kept constant</span>
<span class="sd">                    - choose it depending on geometry size</span>

<span class="sd">            meshmode (str):</span>

<span class="sd">                - &#39;fineness&#39;: adapt mesh size to geometry</span>
<span class="sd">                - &#39;esize&#39;: keep explicitly defined element size  NOT TESTED WITH CGX</span>

<span class="sd">            timeout (int): time in seconds before the process throws a</span>
<span class="sd">                subprocess.TimeoutExpired</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fbd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">comps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cfiles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Calculix CGX elements</span>
        <span class="c1"># axisymmetric</span>
        <span class="n">cgx_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;tri2axisym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tr6c&#39;</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;tri1axisym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tr3c&#39;</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;quad2axisym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;qu8c&#39;</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;quad1axisym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;qu4c&#39;</span>
        <span class="c1"># plane stress</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;tri2plstress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tr6s&#39;</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;tri1plstress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tr3s&#39;</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;quad2plstress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;qu8s&#39;</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;quad1plstress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;qu4s&#39;</span>
        <span class="c1"># plane strain</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;tri2plstrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tr6e&#39;</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;tri1plstrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tr3e&#39;</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;quad2plstrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;qu8e&#39;</span>
        <span class="n">cgx_elements</span><span class="p">[</span><span class="s1">&#39;quad1plstrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;qu4e&#39;</span>

        <span class="n">num</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">size</span>
        <span class="n">emult</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">num</span><span class="p">))</span> <span class="c1"># this converts size to mesh multiplier</span>

        <span class="c1"># write all points</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="n">linestr</span> <span class="o">=</span> <span class="s1">&#39;pnt </span><span class="si">%s</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
            <span class="c1"># gmsh can&#39;t make node componenets so don&#39;t do it in cgx</span>
            <span class="c1">#L = &#39;seta %s p %s&#39; % (pt.get_name(), pt.get_name())</span>
            <span class="c1">#comps.append(L)</span>

        <span class="c1"># write all lines</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">lname</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">pt1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">pt2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">linestr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Arc</span><span class="p">):</span>
                <span class="c1"># line is arc</span>
                <span class="n">pctr</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">actr</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s1">&#39;line </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lname</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pctr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># straight line</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s1">&#39;line </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lname</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
            <span class="c1"># set division if we have it</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">ediv</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ndiv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eorder</span><span class="o">*</span><span class="n">line</span><span class="o">.</span><span class="n">ediv</span>
                <span class="n">linestr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ndiv</span><span class="p">))</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
            <span class="n">linestr</span> <span class="o">=</span> <span class="s1">&#39;seta </span><span class="si">%s</span><span class="s1"> l </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lname</span><span class="p">,</span> <span class="n">lname</span><span class="p">)</span>
            <span class="n">comps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
            <span class="n">cfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lname</span><span class="p">)</span>

        <span class="c1"># write all areas</span>
        <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s1">&#39;gsur &#39;</span><span class="o">+</span><span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; + BLEND &#39;</span>
                <span class="n">line_ids</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">area</span><span class="o">.</span><span class="n">signlines</span><span class="p">:</span>
                    <span class="n">lname</span> <span class="o">=</span> <span class="s1">&#39;+ &#39;</span><span class="o">+</span><span class="n">line</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">lname</span> <span class="o">=</span> <span class="s1">&#39;- &#39;</span><span class="o">+</span><span class="n">line</span><span class="o">.</span><span class="n">get_name</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">line_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lname</span><span class="p">)</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="n">linestr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_ids</span><span class="p">)</span>
                <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
                <span class="c1"># add area component, nodes + elements</span>
                <span class="n">astr</span> <span class="o">=</span> <span class="s1">&#39;seta </span><span class="si">%s</span><span class="s1"> s </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
                <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">astr</span><span class="p">)</span>
                <span class="n">cfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>

        <span class="c1"># write part area components</span>
        <span class="k">for</span> <span class="n">apart</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="c1"># make components for each part</span>
            <span class="c1"># seta P0 s s0 s1</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;seta </span><span class="si">%s</span><span class="s1"> s &#39;</span> <span class="o">%</span> <span class="n">apart</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">cfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">apart</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="n">area_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">apart</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                    <span class="n">area_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">area_ids</span><span class="p">)</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="c1"># mesh all areas</span>
            <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">apart</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
                <span class="n">aname</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="n">estr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eorder</span><span class="p">)</span><span class="o">+</span><span class="n">area</span><span class="o">.</span><span class="n">etype</span>
                <span class="n">cgx_etype</span> <span class="o">=</span> <span class="n">cgx_elements</span><span class="p">[</span><span class="n">estr</span><span class="p">]</span>
                <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;elty </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aname</span><span class="p">,</span> <span class="n">cgx_etype</span><span class="p">))</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;div all mult </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">emult</span><span class="p">)</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;mesh all&#39;</span><span class="p">)</span>

        <span class="c1"># save mesh file</span>
        <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;send all abq&#39;</span><span class="p">)</span>

        <span class="c1"># add line and area components</span>
        <span class="n">fbd</span> <span class="o">+=</span> <span class="n">comps</span>

        <span class="c1"># save component node and element sets</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">cfiles</span><span class="p">:</span>
            <span class="c1"># select nodes under</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;comp </span><span class="si">%s</span><span class="s1"> do&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">comp</span><span class="p">,))</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;send </span><span class="si">%s</span><span class="s1"> abq names&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">comp</span><span class="p">,))</span>

        <span class="c1"># this orients the view correctly</span>
        <span class="c1"># this is the same as switching to the z+ orientation</span>
        <span class="c1"># y us axial, x is radial</span>
        <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rot z&#39;</span><span class="p">)</span>
        <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rot c -90&#39;</span><span class="p">)</span>
        <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;plot e all&#39;</span><span class="p">)</span>

        <span class="c1"># write fbd file to the local directory</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.fbd&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fbd</span><span class="p">:</span>
            <span class="c1">#print (line)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File: </span><span class="si">%s</span><span class="s1"> was written&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>

        <span class="c1"># run file in bg mode</span>
        <span class="n">runstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> -bg </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">CGX</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">runstr</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Meshing done!&#39;</span><span class="p">)</span>

        <span class="c1"># assemble the output files into a ccx input file</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;all.msh&#39;</span><span class="p">]</span>
        <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span><span class="n">f</span><span class="o">+</span><span class="s1">&#39;.nam&#39;</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cfiles</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
                <span class="c1"># cgx adds E and N prfixes on sets after =, get rid of these</span>
                <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">fname</span> <span class="o">!=</span> <span class="s1">&#39;all.msh&#39;</span><span class="p">:</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">inp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># delete file</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="c1"># write out inp file</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.inp&#39;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inp</span><span class="p">:</span>
            <span class="c1">#print (line)</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File: </span><span class="si">%s</span><span class="s1"> was written&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>

        <span class="c1"># read in the calculix mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_inp</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">pycalculix</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pycalculix.html">pycalculix package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Justin Black.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>